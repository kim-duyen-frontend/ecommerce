import { wrapper } from '@/app/store';
import ListProduct from '@/components/ListProduct/ListProduct';
import { getCartProduct, getListProduct, getListSortProduct, selectCollectionEcommerceSelector } from '@/features';
import { NextPage } from 'next';
import Head from 'next/head'
import { Container, Flex, Group, Tabs, Space } from '@mantine/core';
import IconListCart from '@/components/IconCart/IconListCart';
import IconListHeart from '@/components/IconHeart/IconListHeart';
import SearchProduct from '@/components/SearchProduct/SearchProduct';
import Image from 'next/image';
import { useAppDispatch, useAppSelector } from '@/app/hooks';
import PaginationProduct from '@/components/PaginationProduct/PaginationProduct';
import React, { useEffect, useCallback } from "react"
import { LIMIT_PAGE } from '@/utils/constVariable';

const Home: NextPage = () => {
  const dispatch = useAppDispatch()
  const { newFilterSearchList, products } = useAppSelector(selectCollectionEcommerceSelector);

  const callAPI = useCallback(async () => {
    await dispatch(getCartProduct()).unwrap()
  }, [dispatch])

  useEffect(() => {
    callAPI()
  }, [callAPI])

  return (
    <>
      <Head>
        <title>Products</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Container fluid>
        <Flex
          mih={70}
          gap="md"
          justify="space-between"
          align="center"
          direction="row"
          wrap="wrap"
          className='py-3'
        >
          <Image src={`/next.svg`} width={100} height={100} alt="logo" />
          <SearchProduct />
          <Group position="right">
            <IconListCart />
            <IconListHeart />
          </Group>
        </Flex>
        <Space h="md" />
        <Tabs
          keepMounted={false} defaultValue="all"
          onTabChange={(value: string) => dispatch(getListSortProduct(value))}
        >
          <Tabs.List>
            <Tabs.Tab value="all">Phổ biến</Tabs.Tab>
            <Tabs.Tab value="price asc">Giá Thấp Đến Cao</Tabs.Tab>
            <Tabs.Tab value="price desc">Giá Cao Đến Thấp</Tabs.Tab>
          </Tabs.List>
          <Space h="md" />
          <Tabs.Panel value="all">
            <ListProduct />
          </Tabs.Panel>
          <Tabs.Panel value="price asc">
            <ListProduct />
          </Tabs.Panel>
          <Tabs.Panel value="price desc">
            <ListProduct />
          </Tabs.Panel>
        </Tabs>
      </Container>
      <Space h="md" />
      {products?.length >= LIMIT_PAGE && (
        <PaginationProduct total={products?.length} />
      )}
      {newFilterSearchList?.length > 0 && !products && (
        <PaginationProduct total={newFilterSearchList?.length} />
      )}
    </>
  )
}
Home.getInitialProps = wrapper.getInitialPageProps(({ dispatch }) => async () => {
  await dispatch(getListProduct())
})
export default Home